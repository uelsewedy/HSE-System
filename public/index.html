<!doctype html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>HSE Digitalization System</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" type="image/png" href="TURNKEY3.png" />

        <link
            href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />
    </head>
    <body>
        <div id="loader-overlay">
            <div class="spinner"></div>
            <p>جاري التحميل...</p>
        </div>

        <div id="login-screen" class="split-screen">
            <div class="left-pane">
                <div class="login-container">
                    <p class="welcome-text">
                        Welcome to HSE Digitalization System
                    </p>

                    <form id="login-form">
                        <div class="form-group">
                            <label for="username"
                                ><i class="fas fa-user"></i> Username</label
                            >
                            <input
                                type="text"
                                id="username"
                                placeholder="اسم المستخدم"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <label for="password"
                                ><i class="fas fa-lock"></i> Password</label
                            >
                            <input
                                type="password"
                                id="password"
                                placeholder="كلمة المرور"
                                required
                            />
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            تسجيل الدخول
                        </button>
                        <p id="login-error" class="error-message"></p>
                    </form>
                    <a href="/" class="back-link">
                        <i class="fas fa-arrow-right"></i> Back to dashboard
                    </a>
                </div>
            </div>

            <div class="right-pane">
                <button
                    id="lang-switch-btn"
                    class="lang-btn"
                    onclick="toggleLanguage()"
                >
                    <i class="fas fa-globe"></i> <span>العربية</span>
                </button>

                <div id="content-en" class="info-content fade-in">
                    <h1>
                        ADVANCED HSE <br />
                        Digitalization System
                    </h1>

                    <p class="intro-text">
                        A transformational solution designed and developed
                        entirely by our
                        <strong>Internal HSE Management Team</strong>. Crafted
                        to facilitate documentation for credible records while
                        aiming at a <strong>paperless workflow</strong> to
                        preserve the environment and achieve
                        <strong>Sustainability Goals</strong>.
                    </p>

                    <div class="info-grid">
                        <div class="info-box">
                            <h4><i class="fas fa-star"></i> Benefits</h4>
                            <ul>
                                <li>Access data quickly and easily</li>
                                <li>Improve data security & credibility</li>
                                <li>Standardize Workflow</li>
                                <li>
                                    Preserving the environment & achieving
                                    sustainability
                                </li>
                                <li>Generate customizable reports</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>
                                <i class="fas fa-file-contract"></i>
                                Capabilities
                            </h4>
                            <ul>
                                <li>PPEs & Equipment Tracking</li>
                                <li>Permit To Work (PTW)</li>
                                <li>Violations & Incidents</li>
                                <li>HSE Training Records</li>
                            </ul>
                        </div>
                    </div>

                    <div class="footer-note">
                        <p>
                            In addition, users can extract required reports by
                            generating reports with customizable fields, which
                            will help to both collect relevant data as well as
                            analyze the required data for better insights.
                        </p>
                    </div>
                </div>

                <div
                    id="content-ar"
                    class="info-content fade-in"
                    style="display: none"
                    dir="rtl"
                >
                    <h1>
                        نظام رقمنة السلامة <br />
                        والصحة المهنية والبيئة
                    </h1>

                    <p class="intro-text">
                        حل جذري متكامل تم تصميمه وتطويره بالكامل بواسطة
                        <strong
                            >فريق إدارة السلامة والصحة المهنية والبيئة</strong
                        >. يهدف لتسهيل التوثيق والحصول على سجلات موثوقة، مع ضمان
                        الحفاظ على البيئة عبر نظام
                        <strong>عمل بلا أوراق</strong>، تحقيقاً لأهداف الاستدامة
                        العالمية.
                    </p>

                    <div class="info-grid">
                        <div class="info-box">
                            <h4><i class="fas fa-star"></i> فوائد النظام</h4>
                            <ul>
                                <li>الوصول للبيانات بسرعة وسهولة</li>
                                <li>تحسين أمن ومصداقية البيانات</li>
                                <li>توحيد إجراءات العمل القياسية</li>
                                <li>الحفاظ على البيئة وتحقيق الاستدامة</li>
                                <li>استخراج تقارير مخصصة ودقيقة</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>
                                <i class="fas fa-file-contract"></i> إمكانيات
                                النظام
                            </h4>
                            <ul>
                                <li>متابعة مهمات الوقاية والمعدات (PPEs)</li>
                                <li>نظام تصاريح العمل الإلكتروني (PTW)</li>
                                <li>تسجيل وإدارة المخالفات والحوادث</li>
                                <li>إدارة سجلات التدريب والتوعية</li>
                            </ul>
                        </div>
                    </div>

                    <div class="footer-note">
                        <p>
                            بالإضافة إلى ذلك، يتي � النظام استخراج التقارير
                            المطلوبة عبر حقول قابلة للتخصيص، مما يساعد في جمع
                            البيانات وتحليلها بدقة للحصول على رؤى تدعم اتخاذ
                            القرار الصحيح.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="app-wrapper" style="display: none">
            <nav id="sidebar">
                <div class="sidebar-header">
                    <h3 id="welcome-user">أهلاً، ...</h3>
                    <p id="user-role">...</p>
                </div>
                <ul id="sidebar-menu" class="list-unstyled components"></ul>
                <div class="sidebar-footer">
                    <a
                        href="https://turnkey-hse-dashboard.vercel.app/"
                        class="back-to-dash-btn"
                    >
                        <i class="fas fa-arrow-left"></i> Back to dashboard
                    </a>
                    <a href="#" id="logout-btn"
                        ><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a
                    >
                </div>
            </nav>

            <main id="content">
                <div class="mobile-header">
                    <button type="button" id="sidebar-toggle" class="btn">
                        <i class="fas fa-bars"></i></button
                    ><span>HSE Digitalization System</span>
                </div>

                <section
                    id="Dashboard"
                    class="page-section"
                    style="display: none"
                >
                    <div class="welcome-card">
                        <div class="welcome-text-content">
                            <h2 id="dash-welcome">مرحباً بك، ...</h2>
                            <p class="dash-role">
                                <i class="fas fa-user-tag"></i> المسمى الوظيفي:
                                <span id="dash-role-val">...</span>
                            </p>
                            <p class="dash-date">
                                <i class="far fa-calendar-alt"></i>
                                <span id="dash-date-val">...</span>
                            </p>
                        </div>

                        <div class="welcome-image-content"></div>
                    </div>

                    <div
                        class="dash-stats"
                        style="margin-top: 25px; display: none"
                    ></div>
                    <div
                        class="dashboard-events-section"
                        style="margin-top: 30px"
                    >
                        <h3
                            style="
                                color: var(--primary-color);
                                border-bottom: 2px solid #eee;
                                padding-bottom: 10px;
                                margin-bottom: 20px;
                            "
                        >
                            <i class="fas fa-camera-retro"></i> معرض الصور
                        </h3>

                        <div class="events-grid">
                            <div class="event-card">
                                <img src="/one.png" alt="Event 1" />
                                <div class="event-overlay">
                                    <span
                                        >اليوم العالمى للسلامة والصحة المهنية
                                        2025</span
                                    >
                                </div>
                            </div>

                            <div class="event-card">
                                <img src="/cover2.jpeg" alt="Event 2" />
                                <div class="event-overlay">
                                    <span>حملة الاجهاد الحرارى 2025</span>
                                </div>
                            </div>

                            <div class="event-card">
                                <img
                                    src="/World Clean Air Day EN.jpg"
                                    alt="Event 3"
                                />
                                <div class="event-overlay">
                                    <span>اليوم العالمى للهواء النقى</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section
                    id="NewPermit"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-file-signature"></i> إصدار تصريح جديد
                    </h2>
                    <form id="permit-form" class="app-form">
                        <div class="form-row-disabled">
                            <div class="form-group-static">
                                <label>المشرف:</label
                                ><input
                                    type="text"
                                    id="permit-issuer"
                                    readonly
                                />
                            </div>
                            <div class="form-group-static">
                                <label>تاريخ التقديم:</label
                                ><input
                                    type="text"
                                    id="permit-timestamp"
                                    readonly
                                />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="permit-project">المشروع:</label
                                ><select id="permit-project" required>
                                    <option value="">اختر...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="permit-date">تاريخ التصريح:</label
                                ><input type="date" id="permit-date" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="permit-shift">الوردية:</label
                                ><select id="permit-shift" required>
                                    <option value="">اختر...</option>
                                    <option value="صباحية">صباحية</option>
                                    <option value="مسائية">مسائية</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="permit-type">النوع:</label
                                ><select id="permit-type" required>
                                    <option value="">اختر...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="permit-requester"
                                    >الجهة الطالبة:</label
                                ><select id="permit-requester" required>
                                    <option value="">اختر...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="permit-engineer"
                                    >مهندس الموقع:</label
                                ><input type="text" id="permit-engineer" />
                            </div>
                        </div>
                        <div
                            class="form-group"
                            id="permit-subcontractor-group"
                            style="display: none"
                        >
                            <label for="permit-subcontractor"
                                >اسم المقاول:</label
                            >
                            <select id="permit-subcontractor" required></select>
                        </div>
                        <div class="form-group">
                            <label for="permit-location">مكان العمل:</label
                            ><input type="text" id="permit-location" required />
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="permit-starttime">وقت البدء:</label
                                ><input
                                    type="time"
                                    id="permit-starttime"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label for="permit-workers">عدد العمال:</label
                                ><input
                                    type="number"
                                    id="permit-workers"
                                    min="1"
                                    required
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="permit-description">وصف العمل:</label
                            ><textarea
                                id="permit-description"
                                rows="3"
                                required
                            ></textarea>
                        </div>
                        <div
                            id="permit-delay-group"
                            style="
                                display: none;
                                background-color: #fff3cd;
                                padding: 10px;
                                border-radius: 5px;
                                border: 1px solid #ffeeba;
                                margin-bottom: 15px;
                            "
                        >
                            <p
                                style="
                                    color: #856404;
                                    font-size: 0.9em;
                                    margin-top: 0;
                                "
                            >
                                <i class="fas fa-exclamation-circle"></i>
                                <strong>تنبيه:</strong> لقد تجاوزت الساعة 8:00
                                صباحاً. يرجى ذكر سبب التأخير.
                            </p>
                            <div class="form-group">
                                <label
                                    for="permit-delay-reason"
                                    class="required"
                                    >سبب التأخير:</label
                                >
                                <select id="permit-delay-reason">
                                    <option value="">-- اختر السبب --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="permit-delay-desc" class="required"
                                    >اذكر ما حدث بالتفصيل:</label
                                >
                                <textarea
                                    id="permit-delay-desc"
                                    rows="2"
                                    placeholder="اشرح سبب التأخير هنا..."
                                ></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn">حفظ</button>
                        <p id="permit-message" class="success-message"></p>
                    </form>
                </section>

                <section
                    id="ClosePermit"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-clipboard-check"></i> إغلاق التصاريح
                    </h2>
                    <p>التصاريح المفتوحة المسجلة باسمك:</p>
                    <div id="open-permits-list"></div>
                    <p id="close-permit-message" class="success-message"></p>
                </section>

                <section
                    id="NewObservation"
                    class="page-section"
                    style="display: none"
                >
                    <h2><i class="fas fa-eye"></i> تسجيل ملاحظة جديدة</h2>

                    <form id="obs-form" class="app-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>التاريخ:</label>
                                <input
                                    type="text"
                                    id="obs-view-date"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label>الوقت:</label>
                                <input
                                    type="text"
                                    id="obs-view-time"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="obs-project" class="required"
                                >المشروع:</label
                            >
                            <select id="obs-project" required></select>
                        </div>

                        <div class="form-group">
                            <label for="obs-location-detail" class="required"
                                >مكان الملاحظة بالتفصيل:</label
                            >
                            <input
                                type="text"
                                id="obs-location-detail"
                                placeholder="مثال: الدور الثاني - منطقة السقالات"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <label for="obs-source" class="required"
                                >مصدر الملاحظة (Inspection Type):</label
                            >
                            <select id="obs-source" required>
                                <option value="">-- اختر --</option>
                                <option value="Random Inspection">
                                    Random Inspection
                                </option>
                                <option value="Daily Inspection">
                                    Daily Inspection
                                </option>
                                <option value="Equipment Inspection">
                                    Equipment Inspection
                                </option>
                                <option value="Monthly Site Tour">
                                    Monthly Site Tour
                                </option>
                                <option value="Weekly Walk Down">
                                    Weekly Walk Down
                                </option>
                                <option value="Internal Audit">
                                    Internal Audit
                                </option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="obs-type" class="required"
                                    >نوع الملاحظة:</label
                                >
                                <select id="obs-type" required>
                                    <option value="">-- اختر --</option>
                                    <option value="Unsafe Act">
                                        تصاريف غير آمن (Unsafe Act)
                                    </option>
                                    <option value="Unsafe Condition">
                                        ظروف غير آمنة (Unsafe Condition)
                                    </option>
                                    <option value="Environmental">
                                        تأثير بيئي (Environmental Impact)
                                    </option>
                                    <option value="Positive">
                                        ملاحظة إيجابية (Positive)
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="obs-hazard" class="required"
                                    >نوع الخطر:</label
                                >
                                <select id="obs-hazard" required>
                                    <option value="">جاري التحميل...</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="obs-desc" class="required"
                                >وصف الملاحظة:</label
                            >
                            <textarea
                                id="obs-desc"
                                rows="3"
                                required
                            ></textarea>
                        </div>

                        <div
                            class="form-group"
                            style="
                                background: #f9f9f9;
                                padding: 10px;
                                border-radius: 5px;
                                border: 1px solid #ddd;
                            "
                        >
                            <label class="required">المسؤولية على:</label>
                            <div
                                class="radio-group"
                                style="
                                    display: flex;
                                    gap: 20px;
                                    margin-top: 5px;
                                "
                            >
                                <div>
                                    <input
                                        type="radio"
                                        name="obs-resp"
                                        id="resp-elsewedy"
                                        value="الشركه"
                                        checked
                                    />
                                    <label for="resp-elsewedy">الشركة</label>
                                </div>
                                <div>
                                    <input
                                        type="radio"
                                        name="obs-resp"
                                        id="resp-contractor"
                                        value="مقاول"
                                    />
                                    <label for="resp-contractor">مقاول</label>
                                </div>
                            </div>

                            <div
                                id="obs-contractor-div"
                                style="display: none; margin-top: 10px"
                            >
                                <label for="obs-contractor-select"
                                    >اختر المقاول:</label
                                >
                                <select id="obs-contractor-select">
                                    <option value="">-- اختر --</option>
                                </select>
                            </div>
                        </div>

                        <hr />

                        <h4>الإجراءات التصحيحية</h4>
                        <div class="form-row" style="align-items: flex-end">
                            <div class="form-group" style="flex-grow: 2">
                                <label>الإجراء:</label>
                                <input
                                    type="text"
                                    id="obs-action-text"
                                    placeholder="اكتب الإجراء..."
                                />
                            </div>
                            <div class="form-group">
                                <label>تاريخ التنفيذ:</label>
                                <input type="date" id="obs-action-date" />
                            </div>
                            <div class="form-group">
                                <button
                                    type="button"
                                    id="obs-add-action-btn"
                                    class="btn btn-secondary"
                                >
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div
                            id="obs-actions-list"
                            style="margin-bottom: 20px"
                        ></div>

                        <button
                            type="submit"
                            id="obs-save-btn"
                            class="btn"
                            style="width: 100%"
                        >
                            <i class="fas fa-save"></i> حفظ الملاحظة
                        </button>
                        <p
                            id="obs-save-msg"
                            class="success-message"
                            style="display: none"
                        ></p>
                    </form>
                </section>
                <section
                    id="MonitorObservations"
                    class="page-section"
                    style="display: none"
                >
                    <h2><i class="fas fa-search"></i> سجل الملاحظات (بحث)</h2>
                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select id="mon-obs-project">
                                    <option value="">الكل</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>من:</label
                                    ><input type="date" id="mon-obs-from" />
                                </div>
                                <div class="form-group">
                                    <label>إلى:</label
                                    ><input type="date" id="mon-obs-to" />
                                </div>
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="mon-obs-open" />
                                <label
                                    for="mon-obs-open"
                                    style="font-weight: normal"
                                    >المفتوحة فقط</label
                                >
                            </div>
                            <button type="button" id="mon-obs-btn" class="btn">
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>
                        <div
                            id="mon-obs-table"
                            class="results-table-container"
                        ></div>
                    </div>
                </section>
                <section
                    id="MonitorPermits"
                    class="page-section"
                    style="display: none"
                >
                    <h2><i class="fas fa-tasks"></i> سجل التصاريح (بحث)</h2>

                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label for="monitor-project-filter"
                                    >المشروع:</label
                                >
                                <select id="monitor-project-filter">
                                    <option value="ALL_ACCESSIBLE">الكل</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="monitor-requester-filter"
                                    >الجهة الطالبة:</label
                                >
                                <select id="monitor-requester-filter">
                                    <option value="">الكل</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="monitor-from-date">من:</label>
                                    <input type="date" id="monitor-from-date" />
                                </div>
                                <div class="form-group">
                                    <label for="monitor-to-date">إلى:</label>
                                    <input type="date" id="monitor-to-date" />
                                </div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="monitor-open-only" />
                                <label for="monitor-open-only"
                                    >المفتوحة فقط</label
                                >
                            </div>

                            <button
                                type="button"
                                id="monitor-search-btn"
                                class="btn"
                            >
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>

                        <p
                            id="monitor-message"
                            class="error-message"
                            style="text-align: center; display: none"
                        ></p>

                        <div
                            id="monitor-results-table"
                            class="results-table-container"
                        >
                            <p
                                style="
                                    text-align: center;
                                    padding: 20px;
                                    color: #666;
                                "
                            >
                                حدد معايير البحث...
                            </p>
                        </div>
                    </div>
                </section>
                <section
                    id="MyObservations"
                    class="page-section"
                    style="display: none"
                >
                    <h2><i class="fas fa-tasks"></i> ملاحظاتي المفتوحة</h2>

                    <div class="app-form">
                        <button
                            type="button"
                            id="refresh-obs-btn"
                            class="btn btn-secondary"
                            style="margin-bottom: 15px"
                        >
                            <i class="fas fa-sync"></i> تحديث القائمة
                        </button>

                        <div id="my-obs-list" class="results-table-container">
                            <p style="text-align: center">جاري التحميل...</p>
                        </div>
                    </div>
                </section>
                <!-- --- SECTION: KPI Evaluation (New) --- -->

                <section
                    id="KpiEvaluation"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-chart-line"></i> تقييم الموظفين (KPIs)
                    </h2>

                    <div class="kpi-filter-card">
                        <div class="filter-header">
                            <i class="fas fa-filter"></i>
                            <span>إعدادات التقييم</span>
                        </div>

                        <div class="filter-body">
                            <div class="filter-group">
                                <label for="kpi-period-select"
                                    ><i class="far fa-calendar-alt"></i> فترة
                                    التقييم:</label
                                >
                                <input
                                    type="month"
                                    id="kpi-period-select"
                                    class="modern-input"
                                />
                            </div>

                            <div class="filter-group">
                                <label
                                    ><i class="fas fa-user-tie"></i> الموظف
                                    المستهدف:</label
                                >
                                <div
                                    class="custom-select-trigger"
                                    onclick="window.openKpiEmpSelector()"
                                >
                                    <input
                                        type="text"
                                        id="kpi-emp-name-display"
                                        placeholder="اضغط لاختيار موظف من القائمة..."
                                        readonly
                                    />
                                    <i
                                        class="fas fa-search-plus search-icon"
                                    ></i>
                                </div>
                                <input type="hidden" id="kpi-emp-id-hidden" />
                            </div>
                        </div>

                        <div
                            id="kpi-employee-jobtitle"
                            class="employee-meta-info"
                            style="display: none"
                        ></div>
                    </div>

                    <div id="kpi-guidelines-container" class="guidelines-box">
                        <h3>
                            <i class="fas fa-info-circle"></i> دليل حساب نقاط
                            التقييم لعام 2026
                        </h3>
                        <p
                            style="
                                margin-bottom: 10px;
                                font-size: 0.9em;
                                color: #555;
                            "
                        >
                            يرجى اتباع الجدول التالي لحساب الدرجة المحققة بدقة:
                        </p>

                        <table class="guidelines-table">
                            <thead>
                                <tr>
                                    <th>البند (المستهدف)</th>
                                    <th>طريقة الحساب (للنقطة الواحدة)</th>
                                    <th>مثال</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>جلسات TBT (المستهدف 10)</td>
                                    <td>0.25 درجة لكل جلسة</td>
                                    <td>عمل 4 جلسات = 1.0 درجة</td>
                                </tr>
                                <tr>
                                    <td>جولات أسبوعية (المستهدف 4)</td>
                                    <td>1.25 درجة لكل جولة</td>
                                    <td>عمل جولتين = 2.5 درجة</td>
                                </tr>
                                <tr>
                                    <td>تقارير يومية (المستهدف 5)</td>
                                    <td>2.00 درجة لكل تقرير</td>
                                    <td>تقديم 3 تقارير = 6.0 درجات</td>
                                </tr>
                                <tr>
                                    <td>تقارير ملاحظات (المستهدف 10)</td>
                                    <td>1.00 درجة لكل تقرير</td>
                                    <td>تقديم 7 تقارير = 7.0 درجات</td>
                                </tr>
                                <tr>
                                    <td>تقارير مخاطر سنوية (المستهدف 2)</td>
                                    <td>1.25 درجة لكل تقرير</td>
                                    <td>تقديم تقرير واحد = 1.25 درجة</td>
                                </tr>
                                <tr>
                                    <td>تصاريح عمل / فحص معدات (المستهدف 5)</td>
                                    <td>1.00 درجة لكل مستند</td>
                                    <td>تقديم 5 مستندات = 5.0 درجات</td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="note">
                            ⚠️ ملاحظة: المخالفات للقواعد الذهبية تخصم درجة البند
                            بالكامل (0 درجة).
                        </p>
                    </div>

                    <form id="kpi-form-area">
                        <div id="kpi-list-container">
                            <p
                                style="
                                    text-align: center;
                                    color: #777;
                                    padding: 20px;
                                "
                            >
                                الرجاء اختيار الموظف وفترة التقييم لعرض بنود
                                التقييم الخاصة به...
                            </p>
                        </div>

                        <button
                            type="button"
                            id="kpi-save-btn"
                            class="btn btn-primary"
                            onclick="window.handleKpiSave(event)"
                            style="display: none; width: 100%; margin-top: 20px"
                        >
                            <i class="fas fa-save"></i> حفظ التقييمات
                        </button>
                        <p id="kpi-save-message" class="success-message"></p>
                        <p
                            id="kpi-message-area"
                            class="error-message"
                            style="display: none"
                        ></p>
                    </form>
                </section>
                <div
                    id="kpi-emp-modal"
                    class="modal"
                    onclick="if(event.target == this) window.closeKpiEmpSelector()"
                >
                    <div class="modal-content worker-selection-modal">
                        <span
                            class="close-modal"
                            onclick="window.closeKpiEmpSelector()"
                            >&times;</span
                        >
                        <h3
                            style="
                                text-align: center;
                                color: var(--primary-color);
                            "
                        >
                            <i class="fas fa-star"></i> اختيار موظف للتقييم
                        </h3>
                        <div class="form-group" style="margin-bottom: 15px">
                            <input
                                type="text"
                                id="kpi-emp-search-box"
                                placeholder="ابحث بالاسم أو الكود..."
                                oninput="window.filterKpiEmpList()"
                                class="search-input-fancy"
                            />
                        </div>
                        <div
                            id="kpi-emp-list-container"
                            class="modal-scroll-area"
                        ></div>
                    </div>
                </div>

                <section
                    id="ContractorEvaluation"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-hard-hat"></i> تقييم أداء المقاولين
                    </h2>

                    <form id="cont-eval-form" class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select
                                    id="cont-eval-project"
                                    required
                                ></select>
                            </div>
                            <div class="form-group">
                                <label>شهر التقييم:</label>
                                <input
                                    type="month"
                                    id="cont-eval-month"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label>المقاول:</label>
                                <select
                                    id="cont-eval-contractor"
                                    required
                                    disabled
                                >
                                    <option value="">
                                        -- اختر المشروع أولاً --
                                    </option>
                                </select>
                            </div>
                            <button
                                type="button"
                                id="cont-eval-load-btn"
                                class="btn btn-secondary"
                                style="margin-top: 15px"
                            >
                                بدء التقييم
                            </button>
                        </div>

                        <hr />

                        <div id="cont-kpi-container" style="margin-top: 20px">
                            <p style="text-align: center; color: #777">
                                اختر البيانات واضغط "بداء التقييم"
                            </p>
                        </div>

                        <div
                            id="cont-eval-footer"
                            style="display: none; margin-top: 20px"
                        >
                            <h3 style="text-align: center; color: #0056b3">
                                المجموع: <span id="cont-total-score">0</span> /
                                <span id="cont-max-score">0</span>
                            </h3>
                            <button
                                type="submit"
                                class="btn"
                                style="width: 100%"
                            >
                                حفظ التقييم
                            </button>
                        </div>
                    </form>
                </section>
                <!-- --- نهاية القسم الجديد --- -->
                <section
                    id="PpeTransactions"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-boxes"></i> حركات مخزن المهمات (PPE)
                    </h2>

                    <form id="ppe-form" class="app-form">
                        <div class="form-group">
                            <label for="ppe-transaction-type" class="required"
                                >نوع الحركة:</label
                            >
                            <select id="ppe-transaction-type" required>
                                <option value="">-- اختر نوع الحركة --</option>
                                <option value="صرف">1. صرف مهمات</option>
                                <option value="مرتجع">2. مرتجع مهمات</option>
                                <option value="تحويل">3. تحويل مخزون</option>
                                <option value="توريد">
                                    4. توريد مخزون (إضافة رصيد)
                                </option>
                            </select>
                        </div>

                        <div
                            id="ppe-supplier-group"
                            class="ppe-dynamic-group"
                            style="display: none"
                        >
                            <div class="form-row">
                                <div class="form-group">
                                    <label
                                        for="ppe-supplier-name"
                                        class="required"
                                        >اسم المورد:</label
                                    >
                                    <input type="text" id="ppe-supplier-name" />
                                </div>
                                <div class="form-group">
                                    <label
                                        for="ppe-supplier-date"
                                        class="required"
                                        >تاريخ التوريد:</label
                                    >
                                    <input type="date" id="ppe-supplier-date" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    for="ppe-supplier-destination"
                                    class="required"
                                    >التوريد إلى مخزن:</label
                                >
                                <select id="ppe-supplier-destination"></select>
                            </div>
                        </div>

                        <div
                            id="ppe-transfer-group"
                            class="ppe-dynamic-group"
                            style="display: none"
                        >
                            <div class="form-row">
                                <div class="form-group">
                                    <label
                                        for="ppe-transfer-source"
                                        class="required"
                                        >من مخزن:</label
                                    >
                                    <select id="ppe-transfer-source"></select>
                                </div>
                                <div class="form-group">
                                    <label
                                        for="ppe-transfer-destination"
                                        class="required"
                                        >إلى مخزن:</label
                                    >
                                    <select
                                        id="ppe-transfer-destination"
                                    ></select>
                                </div>
                            </div>
                        </div>

                        <div
                            id="ppe-recipient-group"
                            class="ppe-dynamic-group"
                            style="display: none"
                        >
                            <div class="form-group">
                                <label
                                    for="ppe-recipient-location"
                                    id="ppe-recipient-location-label"
                                    class="required"
                                    >الموقع:</label
                                >
                                <select id="ppe-recipient-location"></select>
                            </div>
                            <hr />
                            <div class="form-group">
                                <label for="ppe-recipient-type" class="required"
                                    >نوع المستلم:</label
                                >
                                <select id="ppe-recipient-type">
                                    <option value="">-- اختر النوع --</option>
                                    <option value="موظف">
                                        موظف (من الشركة)
                                    </option>
                                    <option value="مقاول">
                                        مقاول (تابع لشركة)
                                    </option>
                                </select>
                            </div>

                            <div
                                id="ppe-recipient-employee-group"
                                style="display: none"
                            >
                                <div class="form-group">
                                    <label class="required"
                                        >اسم الموظف المستلم:</label
                                    >
                                    <input
                                        type="text"
                                        id="ppe-emp-name-display"
                                        readonly
                                        onclick="window.openPpeEmpSelector()"
                                        placeholder="اضغط لاختيار الموظف..."
                                        style="
                                            cursor: pointer;
                                            background-color: #fff !important;
                                            border: 2px solid #c8102e;
                                        "
                                    />
                                    <input
                                        type="hidden"
                                        id="ppe-emp-id-hidden"
                                    />
                                </div>
                                <div class="form-group checkbox-group">
                                    <input
                                        type="checkbox"
                                        id="ppe-show-all-emp"
                                    />
                                    <label
                                        for="ppe-show-all-emp"
                                        style="font-weight: normal; color: #555"
                                        >عرض موظفي باقي المشاريع (زيارة)</label
                                    >
                                </div>
                            </div>

                            <div
                                id="ppe-emp-modal"
                                class="modal"
                                onclick="if(event.target == this) window.closePpeEmpSelector()"
                            >
                                <div
                                    class="modal-content worker-selection-modal"
                                >
                                    <span
                                        class="close-modal"
                                        onclick="window.closePpeEmpSelector()"
                                        >&times;</span
                                    >
                                    <h3
                                        style="
                                            text-align: center;
                                            color: var(--primary-color);
                                        "
                                    >
                                        <i class="fas fa-user-tag"></i> اختيار
                                        الموظف (المخزن)
                                    </h3>
                                    <div
                                        class="form-group"
                                        style="margin-bottom: 15px"
                                    >
                                        <input
                                            type="text"
                                            id="ppe-emp-search-box"
                                            placeholder="ابحث بالاسم أو الكود..."
                                            oninput="window.filterPpeEmpList()"
                                            class="search-input-fancy"
                                        />
                                    </div>
                                    <div
                                        id="ppe-emp-list-container"
                                        class="modal-scroll-area"
                                    ></div>
                                </div>
                            </div>

                            <div
                                id="ppe-recipient-contractor-group"
                                style="display: none"
                            >
                                <div class="form-group">
                                    <label
                                        for="ppe-recipient-contractor-company"
                                        class="required"
                                        >شركة المقاول:</label
                                    >
                                    <select
                                        id="ppe-recipient-contractor-company"
                                    ></select>
                                </div>
                                <div class="form-group">
                                    <label
                                        for="ppe-recipient-nid"
                                        class="required"
                                        >الرقم القومي:</label
                                    >
                                    <div class="input-with-button">
                                        <input
                                            type="text"
                                            id="ppe-recipient-nid"
                                            placeholder="اكتب الرقم القومي واضغط بحث..."
                                        />
                                        <button
                                            type="button"
                                            id="ppe-nid-search-btn"
                                            class="btn-small"
                                        >
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label
                                        for="ppe-recipient-name"
                                        class="required"
                                        >اسم المستلم:</label
                                    >
                                    <input
                                        type="text"
                                        id="ppe-recipient-name"
                                        placeholder="سيتم ملؤه تلقائياً أو أدخل اسماً جديداً..."
                                    />
                                </div>
                            </div>
                        </div>

                        <div
                            id="ppe-items-group"
                            class="ppe-dynamic-group"
                            style="display: none"
                        >
                            <hr style="margin-top: 25px" />
                            <h4>إضافة مهمات</h4>
                            <div class="form-row">
                                <div class="form-group" style="flex-grow: 3">
                                    <label for="ppe-item-select"
                                        >اختر المهمة:</label
                                    >
                                    <select id="ppe-item-select"></select>
                                </div>
                                <div class="form-group">
                                    <label for="ppe-item-qty">الكمية:</label>
                                    <input
                                        type="number"
                                        id="ppe-item-qty"
                                        min="1"
                                        value="1"
                                    />
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button
                                        type="button"
                                        id="ppe-add-item-btn"
                                        class="btn btn-secondary"
                                    >
                                        <i class="fas fa-plus"></i> إضافة
                                    </button>
                                </div>
                            </div>
                            <p
                                id="ppe-item-balance"
                                style="
                                    text-align: center;
                                    font-weight: bold;
                                    color: #0056b3;
                                "
                            ></p>

                            <h4>قائمة المهمات المطلوبة:</h4>
                            <div id="ppe-cart-container">
                                <p>لم يتم إضافة أي مهمات...</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ppe-notes">ملاحظات (اختياري):</label>
                            <textarea id="ppe-notes" rows="3"></textarea>
                        </div>

                        <button
                            type="submit"
                            id="ppe-save-btn"
                            class="btn"
                            style="width: 100%; margin-top: 20px"
                            disabled
                        >
                            <i class="fas fa-save"></i> حفظ الحركة
                        </button>

                        <p
                            id="ppe-main-message"
                            class="error-message"
                            style="display: none"
                        ></p>
                        <p
                            id="ppe-save-message"
                            class="success-message"
                            style="display: none; white-space: pre-wrap"
                        ></p>
                    </form>
                </section>
                <section
                    id="ProjectStockReport"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-chart-pie"></i> تقرير أرصدة المخازن
                    </h2>

                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label
                                    for="stock-report-project"
                                    class="required"
                                    >اختر الموقع (المشروع أو المخزن):</label
                                >
                                <select id="stock-report-project" required>
                                    <option value="">
                                        -- اختر الموقع لعرض رصيده --
                                    </option>
                                </select>
                            </div>
                            <button
                                type="button"
                                id="stock-report-search-btn"
                                class="btn"
                                style="width: 100%; margin-top: 10px"
                            >
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>

                        <div
                            id="stock-report-results-container"
                            style="margin-top: 25px"
                        >
                            <p
                                id="stock-report-message"
                                style="text-align: center; display: none"
                            ></p>
                            <div
                                id="stock-report-results-table"
                                class="results-table-container"
                            ></div>
                        </div>
                    </div>
                </section>
                <section
                    id="NewTraining"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-chalkboard-teacher"></i> تسجيل تدريب
                        جديد
                    </h2>

                    <form id="training-form" class="app-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>التاريخ:</label>
                                <input
                                    type="text"
                                    id="trn-date"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label>الوقت:</label>
                                <input
                                    type="text"
                                    id="trn-time"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label>المدرب:</label>
                            <input
                                type="text"
                                id="trn-trainer"
                                readonly
                                style="background: #eee"
                            />
                        </div>
                        <div class="form-group">
                            <label for="trn-project" class="required"
                                >المشروع:</label
                            >
                            <select id="trn-project" required></select>
                        </div>
                        <div class="form-group">
                            <label for="trn-topic" class="required"
                                >موضوع التدريب:</label
                            >
                            <select id="trn-topic" required></select>
                        </div>

                        <hr />

                        <h4>تسجيل الحضور</h4>

                        <div class="form-group">
                            <label for="trn-attendee-type">نوع الحاضر:</label>
                            <select id="trn-attendee-type">
                                <option value="موظف">موظف</option>
                                <option value="مقاول">مقاول</option>
                            </select>
                        </div>

                        <div id="trn-emp-group">
                            <div class="form-group">
                                <label>اسم الموظف:</label>
                                <input
                                    type="text"
                                    id="trn-emp-name-display"
                                    readonly
                                    onclick="window.openEmpSelector()"
                                    placeholder="اضغط لاختيار موظف من القائمة..."
                                    style="
                                        cursor: pointer;
                                        background-color: #fff !important;
                                        border: 2px solid #c8102e;
                                    "
                                />
                                <input type="hidden" id="trn-emp-id-hidden" />
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="trn-show-all-emp" />
                                <label
                                    for="trn-show-all-emp"
                                    style="font-weight: normal; color: #555"
                                    >عرض موظفي باقي المشاريع (زيارة)</label
                                >
                            </div>
                        </div>

                        <div id="trn-cont-group" style="display: none">
                            <div class="form-group">
                                <label for="trn-cont-company">الشركة:</label>
                                <select
                                    id="trn-cont-company"
                                    onchange="loadContractorWorkers()"
                                ></select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>الرقم القومي:</label>
                                    <input
                                        type="text"
                                        id="trn-cont-nid"
                                        placeholder="الرقم القومي"
                                        oninput="handleTrnNidInput()"
                                    />
                                </div>
                                <div class="form-group">
                                    <label>الاسم:</label>
                                    <input
                                        type="text"
                                        id="trn-cont-name"
                                        readonly
                                        onclick="window.openWorkerSelector()"
                                        placeholder="اضغط لاختيار عامل..."
                                        style="
                                            cursor: pointer;
                                            background-color: #fff !important;
                                            border: 2px solid #c8102e;
                                        "
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <button
                                type="button"
                                id="trn-add-btn"
                                class="btn btn-secondary"
                                style="width: 100%"
                            >
                                <i class="fas fa-plus"></i> إضافة للقائمة
                            </button>
                        </div>
                        <p
                            id="trn-add-msg"
                            class="error-message"
                            style="display: none; text-align: center"
                        ></p>

                        <h4>قائمة الحضور (<span id="trn-count">0</span>)</h4>
                        <div id="trn-list-container">
                            <p style="text-align: center; color: #777">
                                لم يتم إضافة حضور...
                            </p>
                        </div>

                        <div class="form-group" style="margin-top: 20px">
                            <label>ملاحظات عامة:</label>
                            <textarea id="trn-notes" rows="2"></textarea>
                        </div>

                        <button
                            type="submit"
                            id="trn-save-btn"
                            class="btn"
                            style="width: 100%; margin-top: 10px"
                        >
                            <i class="fas fa-save"></i> حفظ جلسة التدريب
                        </button>
                        <p
                            id="trn-save-msg"
                            class="success-message"
                            style="display: none; white-space: pre-wrap"
                        ></p>
                    </form>
                </section>
                <section
                    id="NewHazard"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-exclamation-circle"></i> تسجيل تقرير
                        خطر (Hazard)
                    </h2>
                    <form id="haz-form" class="app-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>التاريخ:</label
                                ><input
                                    type="text"
                                    id="haz-view-date"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label>الوقت:</label
                                ><input
                                    type="text"
                                    id="haz-view-time"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label>المستخدم (المسجل):</label
                            ><input
                                type="text"
                                id="haz-issuer"
                                readonly
                                style="background: #eee"
                            />
                        </div>

                        <div class="form-group">
                            <label for="haz-project" class="required"
                                >المشروع:</label
                            >
                            <select id="haz-project" required></select>
                        </div>

                        <div
                            class="form-group"
                            style="
                                border: 1px solid #ddd;
                                padding: 10px;
                                border-radius: 5px;
                            "
                        >
                            <label class="required"
                                >بيانات المُبلغ عن الخطر:</label
                            >
                            <div class="form-group">
                                <label for="haz-reporter-type"
                                    >نوع المُبلغ:</label
                                >
                                <select id="haz-reporter-type">
                                    <option value="موظف">موظف</option>
                                    <option value="مقاول">فرد مقاول</option>
                                </select>
                            </div>

                            <div id="haz-emp-group" style="display: none">
                                <div class="form-group">
                                    <label class="required"
                                        >اسم الموظف المبلغ:</label
                                    >
                                    <input
                                        type="text"
                                        id="haz-emp-name-display"
                                        readonly
                                        onclick="window.openHazEmpSelector()"
                                        placeholder="اضغط لاختيار الموظف..."
                                        class="popup-input-style"
                                    />
                                    <input
                                        type="hidden"
                                        id="haz-emp-id-hidden"
                                    />
                                </div>
                                <div class="form-group checkbox-group">
                                    <input
                                        type="checkbox"
                                        id="haz-show-all-emp"
                                    />
                                    <label for="haz-show-all-emp"
                                        >عرض كل الأسماء (زيارة)</label
                                    >
                                </div>
                            </div>

                            <div
                                id="haz-emp-modal"
                                class="modal"
                                onclick="if(event.target == this) window.closeHazEmpSelector()"
                            >
                                <div
                                    class="modal-content worker-selection-modal"
                                >
                                    <span
                                        class="close-modal"
                                        onclick="window.closeHazEmpSelector()"
                                        >&times;</span
                                    >
                                    <h3
                                        style="
                                            text-align: center;
                                            color: var(--primary-color);
                                        "
                                    >
                                        <i
                                            class="fas fa-exclamation-triangle"
                                        ></i>
                                        اختيار الموظف المُبلغ
                                    </h3>
                                    <div
                                        class="form-group"
                                        style="margin-bottom: 15px"
                                    >
                                        <input
                                            type="text"
                                            id="haz-emp-search-box"
                                            placeholder="ابحث بالاسم أو الكود..."
                                            oninput="window.filterHazEmpList()"
                                            class="search-input-fancy"
                                        />
                                    </div>
                                    <div
                                        id="haz-emp-list-container"
                                        class="modal-scroll-area"
                                    ></div>
                                </div>
                            </div>

                            <div id="haz-cont-group" style="display: none">
                                <div class="form-group">
                                    <label for="haz-reporter-company"
                                        >شركة المقاول:</label
                                    >
                                    <select id="haz-reporter-company"></select>
                                </div>
                                <div class="form-group">
                                    <label>الرقم القومي:</label>
                                    <div class="input-with-button">
                                        <input
                                            type="text"
                                            id="haz-reporter-nid"
                                            placeholder="بحث..."
                                        />
                                        <button
                                            type="button"
                                            id="haz-nid-search-btn"
                                            class="btn-small"
                                        >
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>الاسم:</label
                                    ><input
                                        type="text"
                                        id="haz-reporter-name"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="haz-desc" class="required"
                                >وصف الخطورة:</label
                            >
                            <textarea
                                id="haz-desc"
                                rows="3"
                                required
                            ></textarea>
                        </div>
                        <div class="form-group">
                            <label for="haz-result" class="required"
                                >النتيجة المتوقعة (Hazard Result):</label
                            >
                            <select id="haz-result" required>
                                <option value="">جاري التحميل...</option>
                            </select>
                        </div>

                        <h4>الإجراءات التصحيحية</h4>
                        <div class="form-row" style="align-items: flex-end">
                            <div class="form-group" style="flex-grow: 2">
                                <label>الإجراء:</label
                                ><input type="text" id="haz-action-text" />
                            </div>
                            <div class="form-group">
                                <label>تاريخ:</label
                                ><input type="date" id="haz-action-date" />
                            </div>
                            <div class="form-group">
                                <button
                                    type="button"
                                    id="haz-add-action-btn"
                                    class="btn btn-secondary"
                                >
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div
                            id="haz-actions-list"
                            style="margin-bottom: 20px"
                        ></div>

                        <button
                            type="submit"
                            id="haz-save-btn"
                            class="btn"
                            style="width: 100%"
                        >
                            حفظ التقرير
                        </button>
                        <p
                            id="haz-save-msg"
                            class="success-message"
                            style="display: none"
                        ></p>
                    </form>
                </section>

                <section
                    id="MyHazards"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-list-alt"></i> تقاريري المفتوحة
                        (Hazards)
                    </h2>
                    <div class="app-form">
                        <button
                            type="button"
                            id="refresh-haz-btn"
                            class="btn btn-secondary"
                            style="margin-bottom: 15px"
                        >
                            تحديث
                        </button>
                        <div id="my-haz-list" class="results-table-container">
                            <p style="text-align: center">جاري التحميل...</p>
                        </div>
                    </div>
                </section>
                <section
                    id="MonitorHazards"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-search-location"></i> سجل تقارير الخطر
                        (بحث)
                    </h2>
                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select id="mon-haz-project">
                                    <option value="">الكل</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>من:</label
                                    ><input type="date" id="mon-haz-from" />
                                </div>
                                <div class="form-group">
                                    <label>إلى:</label
                                    ><input type="date" id="mon-haz-to" />
                                </div>
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="mon-haz-open" />
                                <label
                                    for="mon-haz-open"
                                    style="font-weight: normal"
                                    >المفتوحة فقط</label
                                >
                            </div>
                            <button type="button" id="mon-haz-btn" class="btn">
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>
                        <div
                            id="mon-haz-table"
                            class="results-table-container"
                        ></div>
                    </div>
                </section>
                <section
                    id="NewNcrViolation"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-exclamation-triangle"></i> تسجيل مخالفة
                        / عدم مطابقة
                    </h2>

                    <form id="ncr-form" class="app-form">
                        <div
                            class="form-group"
                            style="
                                background: #fff3cd;
                                padding: 15px;
                                border-radius: 8px;
                                border: 1px solid #ffeeba;
                            "
                        >
                            <label
                                class="required"
                                style="font-size: 1.1em; color: #856404"
                                >نوع التقرير:</label
                            >
                            <div
                                class="radio-group"
                                style="
                                    display: flex;
                                    gap: 30px;
                                    margin-top: 10px;
                                "
                            >
                                <div>
                                    <input
                                        type="radio"
                                        name="report-type"
                                        id="type-ncr"
                                        value="NCR"
                                        checked
                                    />
                                    <label
                                        for="type-ncr"
                                        style="font-weight: bold"
                                        >NCR (حالة عدم مطابقة)</label
                                    >
                                </div>
                                <div>
                                    <input
                                        type="radio"
                                        name="report-type"
                                        id="type-violation"
                                        value="Violation"
                                    />
                                    <label
                                        for="type-violation"
                                        style="font-weight: bold"
                                        >Violation (مخالفة)</label
                                    >
                                </div>
                            </div>
                        </div>

                        <div id="ncr-fields-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>التاريخ:</label>
                                    <input
                                        type="text"
                                        id="ncr-date"
                                        readonly
                                        style="background: #eee"
                                    />
                                </div>
                                <div class="form-group">
                                    <label>الوقت:</label>
                                    <input
                                        type="text"
                                        id="ncr-time"
                                        readonly
                                        style="background: #eee"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>اسم المستخدم (المسجل):</label>
                                <input
                                    type="text"
                                    id="ncr-issuer"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label for="ncr-project" class="required"
                                    >المشروع:</label
                                >
                                <select id="ncr-project" required></select>
                            </div>

                            <hr />

                            <h4>Who observed the NCR (من لاحظ الحالة)</h4>
                            <div class="form-group">
                                <label>التبعية:</label>
                                <select id="ncr-observer-type">
                                    <option value="الشركة">الشركة</option>
                                    <option value="مقاول">
                                        مقاول (Contractor)
                                    </option>
                                </select>
                            </div>

                            <div id="ncr-emp-group">
                                <div class="form-group">
                                    <label>اسم الموظف (المُبلغ):</label>
                                    <input
                                        type="text"
                                        id="ncr-emp-name-display"
                                        readonly
                                        onclick="window.openNcrEmpSelector()"
                                        placeholder="اضغط لاختيار الموظف..."
                                        class="popup-input-style"
                                    />
                                    <input
                                        type="hidden"
                                        id="ncr-emp-id-hidden"
                                    />
                                </div>
                                <div class="form-group checkbox-group">
                                    <input
                                        type="checkbox"
                                        id="ncr-show-all-emp"
                                    />
                                    <label for="ncr-show-all-emp"
                                        >عرض كل الأسماء (زيارة)</label
                                    >
                                </div>
                            </div>

                            <div id="ncr-cont-group" style="display: none">
                                <div class="form-group">
                                    <label for="ncr-observer-company"
                                        >اسم المقاول:</label
                                    >
                                    <select id="ncr-observer-company"></select>
                                </div>
                                <div class="form-group">
                                    <label>الرقم القومي:</label>
                                    <div class="input-with-button">
                                        <input
                                            type="text"
                                            id="ncr-observer-nid"
                                            placeholder="بحث..."
                                        />
                                        <button
                                            type="button"
                                            id="ncr-nid-search-btn"
                                            class="btn-small"
                                        >
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>الاسم:</label
                                    ><input
                                        type="text"
                                        id="ncr-observer-name"
                                    />
                                </div>
                            </div>

                            <hr />

                            <div class="form-group">
                                <label for="ncr-reported-to" class="required"
                                    >لمن تم الإبلاغ (Reported To):</label
                                >
                                <input
                                    type="text"
                                    id="ncr-reported-to"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="ncr-method" class="required"
                                    >How Observed (طريقة الملاحظة):</label
                                >
                                <select id="ncr-method" required>
                                    <option value="">-- Select --</option>
                                    <option value="Preventive inspection">
                                        تفتيش وقائي (Preventive inspection)
                                    </option>
                                    <option value="Internal audit">
                                        مراجعة داخلية (Internal audit)
                                    </option>
                                    <option value="Complaint">
                                        شكوى (Complaint)
                                    </option>
                                    <option value="Data Analysis">
                                        تحليل بيانات (Data Analysis)
                                    </option>
                                    <option value="Other">أخرى (Other)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="ncr-desc" class="required"
                                    >Description of Nonconformity (وصف
                                    الحالة):</label
                                >
                                <textarea
                                    id="ncr-desc"
                                    rows="3"
                                    required
                                ></textarea>
                            </div>

                            <div class="form-group">
                                <label for="ncr-root" class="required"
                                    >Root causes (الأسباب الجذرية):</label
                                >
                                <textarea
                                    id="ncr-root"
                                    rows="2"
                                    placeholder="يمكنك كتابة أكثر من سبب..."
                                    required
                                ></textarea>
                            </div>

                            <hr />

                            <h4>Corrective / Preventive Actions</h4>
                            <div class="form-row" style="align-items: flex-end">
                                <div class="form-group" style="flex: 2">
                                    <label>الإجراء (Action):</label>
                                    <input type="text" id="ncr-act-text" />
                                </div>
                                <div class="form-group">
                                    <label>المسؤول (Responsible):</label>
                                    <input type="text" id="ncr-act-resp" />
                                </div>
                            </div>
                            <div class="form-row" style="align-items: flex-end">
                                <div class="form-group">
                                    <label>تاريخ التنفيذ (Target Date):</label>
                                    <input type="date" id="ncr-act-date" />
                                </div>
                                <div class="form-group">
                                    <button
                                        type="button"
                                        id="ncr-add-act-btn"
                                        class="btn btn-secondary"
                                    >
                                        <i class="fas fa-plus"></i> إضافة
                                    </button>
                                </div>
                            </div>

                            <div
                                id="ncr-actions-list"
                                style="margin-bottom: 20px"
                            ></div>

                            <button
                                type="submit"
                                id="ncr-save-btn"
                                class="btn"
                                style="width: 100%"
                            >
                                حفظ NCR
                            </button>
                            <p
                                id="ncr-save-msg"
                                class="success-message"
                                style="display: none"
                            ></p>
                        </div>

                        <div
                            id="violation-fields-container"
                            style="display: none"
                        >
                            <div class="form-row">
                                <div class="form-group">
                                    <label>التاريخ:</label
                                    ><input
                                        type="text"
                                        id="vio-date"
                                        readonly
                                        style="background: #eee"
                                    />
                                </div>
                                <div class="form-group">
                                    <label>الوقت:</label
                                    ><input
                                        type="text"
                                        id="vio-time"
                                        readonly
                                        style="background: #eee"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>المسجل:</label
                                ><input
                                    type="text"
                                    id="vio-issuer"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label class="required">المشروع:</label>
                                <select id="vio-project" required></select>
                            </div>

                            <hr />

                            <div
                                class="form-group"
                                style="
                                    border: 1px solid #ddd;
                                    padding: 15px;
                                    border-radius: 8px;
                                "
                            >
                                <label class="required">بيانات المخالف:</label>
                                <div class="form-group">
                                    <label>نوع المخالف:</label>
                                    <select id="vio-type">
                                        <option value="موظف">موظف</option>
                                        <option value="مقاول">مقاول</option>
                                    </select>
                                </div>

                                <div id="vio-emp-group">
                                    <div class="form-group">
                                        <label>اسم الموظف المخالف:</label>
                                        <input
                                            type="text"
                                            id="vio-emp-name-display"
                                            readonly
                                            onclick="window.openVioEmpSelector()"
                                            placeholder="اضغط لاختيار الموظف..."
                                            class="popup-input-style"
                                        />
                                        <input
                                            type="hidden"
                                            id="vio-emp-id-hidden"
                                        />
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input
                                            type="checkbox"
                                            id="vio-show-all-emp"
                                        />
                                        <label for="vio-show-all-emp"
                                            >عرض كل الموظفين</label
                                        >
                                    </div>
                                </div>

                                <div id="vio-cont-group" style="display: none">
                                    <div class="form-group">
                                        <label>اسم المقاول (الشركة):</label>
                                        <select id="vio-cont-select"></select>
                                    </div>
                                    <div class="form-group">
                                        <label
                                            >اسم الشخص المخالف (اختياري):</label
                                        ><input
                                            type="text"
                                            id="vio-cont-worker-name"
                                        />
                                    </div>
                                    <div class="form-group">
                                        <label>الرقم القومي (اختياري):</label
                                        ><input type="text" id="vio-cont-nid" />
                                    </div>
                                </div>
                            </div>

                            <hr />

                            <div class="form-group">
                                <label class="required"
                                    >وصف المخالفة (Description):</label
                                >
                                <textarea
                                    id="vio-desc"
                                    rows="3"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label class="required"
                                    >أقوال مسؤول السلامة (HSE Statement):</label
                                >
                                <textarea
                                    id="vio-hse-stmt"
                                    rows="2"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label class="required"
                                    >أقوال المخالف / الشهود:</label
                                >
                                <textarea
                                    id="vio-violator-stmt"
                                    rows="2"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label class="required"
                                    >الإجراء الفوري المتخذ (Immediate
                                    Action):</label
                                >
                                <input
                                    type="text"
                                    id="vio-action-taken"
                                    required
                                />
                            </div>

                            <hr />

                            <div
                                class="form-group"
                                style="
                                    background: #f9f9f9;
                                    padding: 15px;
                                    border: 1px solid #ccc;
                                    border-radius: 8px;
                                "
                            >
                                <label
                                    class="required"
                                    style="font-size: 1.1em; color: #c8102e"
                                    >مستوى المخالفة (Violation Level):</label
                                >

                                <div
                                    class="radio-group"
                                    style="
                                        display: flex;
                                        flex-direction: column;
                                        gap: 10px;
                                        margin-top: 10px;
                                    "
                                >
                                    <div>
                                        <input
                                            type="radio"
                                            name="vio-level"
                                            id="lvl-1"
                                            value="Level 1"
                                            checked
                                        />
                                        <label for="lvl-1"
                                            >Level 1 (First Warning /
                                            Re-induction)</label
                                        >
                                    </div>
                                    <div>
                                        <input
                                            type="radio"
                                            name="vio-level"
                                            id="lvl-2"
                                            value="Level 2"
                                        />
                                        <label for="lvl-2"
                                            >Level 2 (Warning / Notification to
                                            PM)</label
                                        >
                                    </div>
                                    <div>
                                        <input
                                            type="radio"
                                            name="vio-level"
                                            id="lvl-3"
                                            value="Level 3"
                                        />
                                        <label
                                            for="lvl-3"
                                            style="
                                                font-weight: bold;
                                                color: #c8102e;
                                            "
                                            >Level 3 (Penalty /
                                            Deduction)</label
                                        >
                                    </div>
                                </div>

                                <div
                                    id="vio-penalty-div"
                                    style="
                                        display: none;
                                        margin-top: 15px;
                                        border-top: 1px dashed #ccc;
                                        padding-top: 15px;
                                    "
                                >
                                    <h4 style="color: #c8102e">
                                        لائحة الجزاءات
                                    </h4>

                                    <div class="form-group">
                                        <label>البند:</label>
                                        <select id="vio-item-select">
                                            <option>جاري التحميل...</option>
                                        </select>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>النوع:</label>
                                            <select id="vio-repeat-select">
                                                <option value="First">
                                                    أول مرة
                                                </option>
                                                <option value="Repeat">
                                                    تكرار
                                                </option>
                                            </select>
                                        </div>
                                        <div
                                            class="form-group"
                                            id="vio-qty-group"
                                            style="display: none"
                                        >
                                            <label>العدد (أفراد/تكرار):</label>
                                            <input
                                                type="number"
                                                id="vio-qty-input"
                                                value="1"
                                                min="1"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <button
                                                type="button"
                                                id="vio-add-btn"
                                                class="btn btn-secondary"
                                            >
                                                <i class="fas fa-plus"></i>
                                                إضافة
                                            </button>
                                        </div>
                                    </div>

                                    <div
                                        id="vio-list-container"
                                        style="margin-bottom: 10px"
                                    ></div>

                                    <div
                                        style="
                                            background: #fff;
                                            padding: 10px;
                                            border: 1px solid #ddd;
                                            border-radius: 5px;
                                            display: flex;
                                            justify-content: space-between;
                                            align-items: center;
                                        "
                                    >
                                        <strong>إجمالي الغرامة / الخصم:</strong>
                                        <span
                                            id="vio-total-display"
                                            style="
                                                color: #c8102e;
                                                font-size: 1.3em;
                                                font-weight: bold;
                                            "
                                            >0</span
                                        >
                                    </div>
                                </div>
                            </div>

                            <button
                                type="submit"
                                id="vio-save-btn"
                                class="btn"
                                style="width: 100%; margin-top: 20px"
                            >
                                حفظ المخالفة
                            </button>
                        </div>
                    </form>
                </section>
                <section id="MyNCRs" class="page-section" style="display: none">
                    <h2>
                        <i class="fas fa-tasks"></i> حالات عدم المطابقة المفتوحة
                        (My NCRs)
                    </h2>
                    <div class="app-form">
                        <button
                            type="button"
                            id="refresh-ncr-btn"
                            class="btn btn-secondary"
                            style="margin-bottom: 15px"
                        >
                            <i class="fas fa-sync"></i> تحديث القائمة
                        </button>
                        <div id="my-ncr-list" class="results-table-container">
                            <p style="text-align: center">جاري التحميل...</p>
                        </div>
                    </div>
                </section>
                <section
                    id="MonitorNcrViolations"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-search"></i> سجل المخالفات وحالات عدم
                        المطابقة
                    </h2>

                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select id="mon-ncrvio-project">
                                    <option value="ALL_ACCESSIBLE">الكل</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>من:</label
                                    ><input type="date" id="mon-ncrvio-from" />
                                </div>
                                <div class="form-group">
                                    <label>إلى:</label
                                    ><input type="date" id="mon-ncrvio-to" />
                                </div>
                            </div>
                            <button
                                type="button"
                                id="mon-ncrvio-btn"
                                class="btn"
                            >
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>

                        <div
                            id="mon-ncrvio-table"
                            class="results-table-container"
                        >
                            <p
                                style="
                                    text-align: center;
                                    padding: 20px;
                                    color: #666;
                                "
                            >
                                حدد معايير البحث...
                            </p>
                        </div>
                    </div>
                </section>
                <section
                    id="NewContractor"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-file-upload"></i> تسجيل مقاولين (رفع
                        اشتراطات)
                    </h2>

                    <form id="contractor-form" class="app-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>التاريخ:</label
                                ><input
                                    type="text"
                                    id="cont-date"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                            <div class="form-group">
                                <label>الوقت:</label
                                ><input
                                    type="text"
                                    id="cont-time"
                                    readonly
                                    style="background: #eee"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label>المستخدم:</label
                            ><input
                                type="text"
                                id="cont-issuer"
                                readonly
                                style="background: #eee"
                            />
                        </div>

                        <div class="form-group">
                            <label for="cont-project" class="required"
                                >المشروع:</label
                            >
                            <select id="cont-project" required></select>
                        </div>

                        <div class="form-group">
                            <label for="cont-contractor" class="required"
                                >اسم المقاول:</label
                            >
                            <select id="cont-contractor" required disabled>
                                <option value="">
                                    -- اختر المشروع أولاً --
                                </option>
                            </select>
                        </div>

                        <div
                            class="form-group"
                            style="
                                border: 2px dashed #ccc;
                                padding: 20px;
                                text-align: center;
                                border-radius: 10px;
                                background: #fcfcfc;
                            "
                        >
                            <label
                                for="cont-file"
                                class="required"
                                style="
                                    font-size: 1.1em;
                                    color: #c8102e;
                                    cursor: pointer;
                                "
                            >
                                <i
                                    class="fas fa-cloud-upload-alt"
                                    style="
                                        font-size: 2em;
                                        display: block;
                                        margin-bottom: 10px;
                                    "
                                ></i>
                                اختر ملف الاشتراطات (PDF)
                            </label>
                            <input
                                type="file"
                                id="cont-file"
                                accept="application/pdf"
                                style="display: none"
                                required
                            />
                            <p
                                id="file-name-display"
                                style="
                                    margin-top: 10px;
                                    color: #555;
                                    font-weight: bold;
                                "
                            >
                                لم يتم اختيار ملف
                            </p>
                        </div>

                        <button
                            type="submit"
                            id="cont-save-btn"
                            class="btn"
                            style="width: 100%; margin-top: 20px"
                        >
                            <i class="fas fa-save"></i> حفظ ورفع الملف
                        </button>
                        <p
                            id="cont-save-msg"
                            class="success-message"
                            style="display: none"
                        ></p>
                    </form>
                </section>
                <section
                    id="ContractorAnalytics"
                    class="page-section"
                    style="display: none"
                >
                    <div
                        class="print-header-only"
                        style="
                            display: none;
                            align-items: center;
                            justify-content: space-between;
                            border-bottom: 2px solid #c8102e;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        "
                    >
                        <img
                            src="../turnkey.png"
                            alt="Logo"
                            style="max-height: 60px"
                        />

                        <div style="text-align: center; flex-grow: 1">
                            <h1
                                style="
                                    color: #c8102e;
                                    margin: 0;
                                    font-size: 1.5rem;
                                "
                            >
                                HSE Contractor Performance Report
                            </h1>
                            <p
                                style="margin: 5px 0 0 0; font-size: 0.9rem"
                                id="print-date-display"
                            ></p>
                        </div>
                    </div>
                    <h2>
                        <i class="fas fa-chart-bar"></i> تقارير أداء المقاولين
                    </h2>

                    <div class="app-form no-print">
                        <div
                            class="filter-controls"
                            style="align-items: flex-end; flex-wrap: wrap"
                        >
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select id="ana-project">
                                    <option value="ALL_ACCESSIBLE">
                                        كل المشاريع
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>المقاول:</label>
                                <select id="ana-contractor">
                                    <option value="ALL">كل المقاولين</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>شهر التقرير:</label>
                                <input type="month" id="ana-month" />
                            </div>

                            <div
                                class="checkbox-group"
                                style="
                                    margin-right: 15px;
                                    border: 1px solid #ccc;
                                    padding: 5px;
                                    border-radius: 5px;
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 5px;
                                        margin-bottom: 5px;
                                    "
                                >
                                    <input
                                        type="checkbox"
                                        id="ana-cumulative"
                                    />
                                    <label
                                        for="ana-cumulative"
                                        style="margin: 0; font-size: 0.9em"
                                        >تراكمي (من البداية)</label
                                    >
                                </div>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 5px;
                                        margin-bottom: 5px;
                                    "
                                >
                                    <input type="checkbox" id="ana-sort-kpi" />
                                    <label
                                        for="ana-sort-kpi"
                                        style="margin: 0; font-size: 0.9em"
                                        >ترتيب حسب KPI</label
                                    >
                                </div>
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 5px;
                                    "
                                >
                                    <input
                                        type="checkbox"
                                        id="ana-merge-proj"
                                        checked
                                    />
                                    <label
                                        for="ana-merge-proj"
                                        style="margin: 0; font-size: 0.9em"
                                        >دمج المشاريع</label
                                    >
                                </div>
                            </div>

                            <button
                                type="button"
                                id="ana-search-btn"
                                class="btn"
                            >
                                <i class="fas fa-search"></i> عرض التقرير
                            </button>
                        </div>

                        <div
                            class="export-controls"
                            style="
                                margin-top: 20px;
                                padding: 10px;
                                background: #f1f1f1;
                                border-radius: 5px;
                            "
                        >
                            <h4 style="margin-top: 0; color: #333">
                                خيارات التصدير (PDF):
                                <small style="font-weight: normal"
                                    >حدد الأعمدة التي تريد طباعتها</small
                                >
                            </h4>
                            <div
                                class="columns-selector"
                                style="
                                    display: flex;
                                    flex-wrap: wrap;
                                    gap: 10px;
                                    margin-bottom: 10px;
                                "
                            >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="0"
                                    />
                                    المقاول</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="1"
                                    />
                                    المشروع</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="2"
                                    />
                                    التصاريح</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="3"
                                    />
                                    تدريب (عادي)</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="4"
                                    />
                                    Induction</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="5"
                                    />
                                    الملاحظات</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="6"
                                    />
                                    Hazard Reports</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="7"
                                    />
                                    مهمات (PPE)</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="8"
                                    />
                                    مخالفات</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="9"
                                    />
                                    NCR</label
                                >
                                <label
                                    ><input
                                        type="checkbox"
                                        checked
                                        data-col="10"
                                    />
                                    KPI Score</label
                                >
                            </div>
                            <button
                                type="button"
                                id="ana-print-btn"
                                class="btn btn-secondary"
                                style="background: #28a745; width: 100%"
                            >
                                <i class="fas fa-file-pdf"></i> تحميل PDF
                                (طباعة)
                            </button>
                        </div>
                    </div>

                    <div
                        id="ana-results-container"
                        class="results-table-container"
                        style="margin-top: 20px"
                    >
                        <p style="text-align: center; color: #666">
                            اضغط "عرض التقرير" لجلب البيانات...
                        </p>
                    </div>
                </section>
                <section
                    id="EmployeeReports"
                    class="page-section"
                    style="display: none"
                >
                    <div
                        class="print-header-only"
                        style="
                            display: none;
                            flex-direction: row-reverse !important;
                            align-items: center;
                            justify-content: space-between;
                            border-bottom: 2px solid #c8102e;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                        "
                    >
                        <img
                            src="../turnkey.png"
                            alt="Logo"
                            style="max-height: 60px"
                        />
                        <div style="text-align: center; flex-grow: 1">
                            <h1
                                style="
                                    color: #c8102e;
                                    margin: 0;
                                    font-size: 1.5rem;
                                "
                            >
                                تقرير سجل الموظف
                            </h1>
                            <p
                                style="margin: 5px 0 0 0; font-size: 0.9rem"
                                id="emp-print-date"
                            ></p>
                        </div>
                    </div>

                    <h2 class="no-print">
                        <i class="fas fa-id-card"></i> ملف الموظف الشامل
                    </h2>

                    <div class="app-form no-print">
                        <div class="form-group" style="position: relative">
                            <label>ابحث باسم الموظف أو الكود:</label>
                            <input
                                type="text"
                                id="emp-search-input"
                                placeholder="اكتب للبحث..."
                                autocomplete="off"
                            />
                            <div
                                id="emp-search-results"
                                class="search-dropdown"
                                style="display: none"
                            ></div>
                        </div>
                    </div>

                    <div
                        id="emp-report-container"
                        style="display: none; margin-top: 20px"
                    >
                        <div class="emp-profile-card">
                            <div class="emp-info-grid">
                                <div>
                                    <strong>الاسم:</strong>
                                    <span id="r-emp-name">-</span>
                                </div>
                                <div>
                                    <strong>الكود:</strong>
                                    <span id="r-emp-id">-</span>
                                </div>
                                <div>
                                    <strong>الوظيفة:</strong>
                                    <span id="r-emp-job">-</span>
                                </div>
                                <div>
                                    <strong>القسم:</strong>
                                    <span id="r-emp-dept">-</span>
                                </div>
                                <div>
                                    <strong>الشركة/التعيين:</strong>
                                    <span id="r-emp-type">-</span>
                                </div>
                                <div>
                                    <strong>المشروع الحالي:</strong>
                                    <span id="r-emp-proj">-</span>
                                </div>
                                <div>
                                    <strong>تاريخ التعيين:</strong>
                                    <span id="r-emp-join">-</span>
                                </div>
                            </div>

                            <div class="emp-kpi-box">
                                <div class="kpi-circle" id="r-emp-kpi-circle">
                                    <span id="r-emp-kpi-val">0%</span>
                                </div>
                                <p>متوسط الأداء (KPI)</p>
                            </div>
                        </div>

                        <hr class="divider" />

                        <h3 class="section-title">
                            <i class="fas fa-chalkboard-teacher"></i> سجل
                            التدريب
                        </h3>
                        <div id="r-training-table" class="report-table-wrapper">
                            لا يوجد سجلات تدريب.
                        </div>

                        <h3 class="section-title">
                            <i class="fas fa-hard-hat"></i> سجل العهدة والمهمات
                            (PPE)
                        </h3>
                        <div id="r-ppe-table" class="report-table-wrapper">
                            لا يوجد سجلات استلام.
                        </div>

                        <h3 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            المخالفات والجزاءات
                        </h3>
                        <div
                            id="r-violations-table"
                            class="report-table-wrapper"
                        >
                            لا يوجد مخالفات مسجلة.
                        </div>
                    </div>

                    <button
                        type="button"
                        id="emp-print-btn"
                        class="btn no-print"
                        style="margin-top: 20px; width: 100%; display: none"
                    >
                        <i class="fas fa-print"></i> طباعة التقرير
                    </button>
                </section>
                <section
                    id="AccidentReport"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-car-crash"></i> تقرير حادث جديد
                        (Accident Report)
                    </h2>

                    <form id="accident-form" class="app-form">
                        <div class="card">
                            <h3>
                                <i class="fas fa-info-circle"></i> البيانات
                                الأساسية
                            </h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>اسم المبلغ (Reporter):</label>
                                    <input
                                        type="text"
                                        id="acc-reporter"
                                        readonly
                                        style="background: #eee"
                                    />
                                </div>
                                <div class="form-group">
                                    <label>تاريخ الحادث:</label>
                                    <input type="date" id="acc-date" required />
                                </div>
                                <div class="form-group">
                                    <label>وقت الحادث:</label>
                                    <input type="time" id="acc-time" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select
                                    id="acc-project"
                                    required
                                    onchange="loadProjectDataForAccident()"
                                >
                                    <option value="">اختر المشروع...</option>
                                </select>
                            </div>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-tags"></i> تصنيف الحادث</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>نوع الحادث:</label>
                                    <select
                                        id="acc-class"
                                        required
                                        onchange="toggleInjuryCount()"
                                    >
                                        <option value="">
                                            اختر التصنيف...
                                        </option>
                                        <option value="Property Damage">
                                            Property Damage
                                        </option>
                                        <option value="Environmental Incident">
                                            Environmental Incident
                                        </option>
                                        <option value="First Aid Injury">
                                            First Aid Injury
                                        </option>
                                        <option value="Medical Treatment">
                                            Medical Treatment
                                        </option>
                                        <option value="LTI">LTI</option>
                                        <option value="Fatality">
                                            Fatality
                                        </option>
                                        <option value="Nearmiss">
                                            Nearmiss
                                        </option>
                                    </select>
                                </div>
                                <div
                                    class="form-group"
                                    id="acc-injuries-count-group"
                                    style="display: none"
                                >
                                    <label>عدد المصابين:</label>
                                    <input
                                        type="number"
                                        id="acc-injuries-count"
                                        min="1"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-pen"></i> تفاصيل الحادث</h3>
                            <div class="form-group">
                                <label
                                    >الروتين اليومي لهذا العمل (Routine
                                    Activity):</label
                                >
                                <textarea id="acc-routine" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>ماذا حدث؟ (What Happened):</label>
                                <textarea
                                    id="acc-what-happened"
                                    rows="3"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label
                                    >متى ولمن تم الإبلاغ؟ (Notification):</label
                                >
                                <input type="text" id="acc-notification" />
                            </div>
                            <div class="form-group">
                                <label>وصف الإصابات / الأضرار:</label>
                                <textarea
                                    id="acc-damage-desc"
                                    rows="2"
                                ></textarea>
                            </div>
                        </div>

                        <div class="card" id="acc-victim-section">
                            <h3>
                                <i class="fas fa-user-injured"></i> الشخص المعني
                                بالحادث (Victim / Primary)
                            </h3>

                            <div class="form-group">
                                <label>النوع:</label>
                                <select
                                    id="acc-vic-type"
                                    onchange="updatePersonInputs('acc-vic')"
                                >
                                    <option value="">اختر...</option>
                                    <option value="Employee">
                                        موظف (Employee)
                                    </option>
                                    <option value="Contractor">
                                        مقاول (Contractor)
                                    </option>
                                    <option value="Visitor">
                                        زائر/عامة (Visitor/Public)
                                    </option>
                                </select>
                            </div>

                            <div
                                class="form-group vic-input-group"
                                id="acc-vic-emp-group"
                                style="display: none"
                            >
                                <label>اسم الموظف:</label>
                                <select
                                    id="acc-vic-emp-select"
                                    class="searchable-select"
                                >
                                    <option value="">اختر الموظف...</option>
                                </select>
                                <div class="checkbox-group">
                                    <input
                                        type="checkbox"
                                        id="acc-vic-emp-all"
                                        onchange="toggleAllEmployees('acc-vic')"
                                    />
                                    <label
                                        for="acc-vic-emp-all"
                                        style="font-weight: normal"
                                        >عرض كل موظفي الشركة</label
                                    >
                                </div>
                            </div>

                            <div
                                class="form-group vic-input-group"
                                id="acc-vic-cont-group"
                                style="display: none"
                            >
                                <label>اسم المقاول (الشركة):</label>
                                <select id="acc-vic-cont-select">
                                    <option value="">اختر المقاول...</option>
                                </select>
                                <div
                                    style="
                                        margin-top: 10px;
                                        display: flex;
                                        gap: 10px;
                                    "
                                >
                                    <input
                                        type="text"
                                        id="acc-vic-nid"
                                        placeholder="الرقم القومي للبحث"
                                    />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="searchPersonByNID('acc-vic')"
                                    >
                                        <i class="fas fa-search"></i> بحث
                                    </button>
                                </div>
                                <input
                                    type="text"
                                    id="acc-vic-cont-name"
                                    placeholder="اسم العامل (يكتب يدوياً أو يظهر بالبحث)"
                                    style="margin-top: 5px"
                                />
                            </div>

                            <div
                                class="form-group vic-input-group"
                                id="acc-vic-vis-group"
                                style="display: none"
                            >
                                <label>بيانات الزائر:</label>
                                <input
                                    type="text"
                                    id="acc-vic-vis-nid"
                                    placeholder="الرقم القومي"
                                />
                                <input
                                    type="text"
                                    id="acc-vic-vis-name"
                                    placeholder="الاسم بالكامل"
                                    style="margin-top: 5px"
                                />
                            </div>
                        </div>

                        <div class="card">
                            <h3>
                                <i class="fas fa-users-cog"></i> الأشخاص
                                المعنيون والشهود
                            </h3>

                            <div class="persons-grid-container">
                                <div class="person-box">
                                    <div class="person-box-header">
                                        <h4>
                                            <i class="fas fa-users"></i> الأشخاص
                                            المتداخلين (Involved)
                                        </h4>
                                        <button
                                            type="button"
                                            class="btn-box-add"
                                            onclick="openPersonModal('involved')"
                                        >
                                            <i class="fas fa-plus"></i> إضافة
                                        </button>
                                    </div>
                                    <div class="list-wrapper">
                                        <ul
                                            id="acc-involved-list"
                                            class="styled-person-list"
                                        ></ul>
                                        <p
                                            id="involved-empty-msg"
                                            class="empty-msg"
                                        >
                                            لم يتم إضافة أشخاص...
                                        </p>
                                    </div>
                                </div>

                                <div class="person-box">
                                    <div class="person-box-header">
                                        <h4>
                                            <i class="fas fa-eye"></i> الشهود
                                            (Witnesses)
                                        </h4>
                                        <button
                                            type="button"
                                            class="btn-box-add"
                                            onclick="openPersonModal('witness')"
                                        >
                                            <i class="fas fa-plus"></i> إضافة
                                        </button>
                                    </div>
                                    <div class="list-wrapper">
                                        <ul
                                            id="acc-witness-list"
                                            class="styled-person-list"
                                        ></ul>
                                        <p
                                            id="witness-empty-msg"
                                            class="empty-msg"
                                        >
                                            لم يتم إضافة شهود...
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>
                                <i class="fas fa-search-plus"></i> تحليل الأسباب
                                (Root Cause Analysis)
                            </h3>

                            <div class="form-group">
                                <label>أسباب مباشرة (Direct Causes):</label>
                                <div class="input-with-button">
                                    <input type="text" id="acc-direct-input" />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-direct-input', 'acc-direct-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul
                                    id="acc-direct-list"
                                    class="simple-list"
                                ></ul>
                            </div>

                            <div class="form-group">
                                <label
                                    >أسباب غير مباشرة (Indirect Causes):</label
                                >
                                <div class="input-with-button">
                                    <input
                                        type="text"
                                        id="acc-indirect-input"
                                    />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-indirect-input', 'acc-indirect-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul
                                    id="acc-indirect-list"
                                    class="simple-list"
                                ></ul>
                            </div>

                            <div class="form-group">
                                <label>أسباب جذرية (Root Causes):</label>
                                <div class="input-with-button">
                                    <input type="text" id="acc-root-input" />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-root-input', 'acc-root-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul id="acc-root-list" class="simple-list"></ul>
                            </div>
                        </div>

                        <div class="card">
                            <h3>
                                <i class="fas fa-check-circle"></i> الإجراءات
                                المتخذة (Control Measures)
                            </h3>

                            <div class="form-group">
                                <label>إجراءات فورية (Immediate):</label>
                                <div class="input-with-button">
                                    <input type="text" id="acc-imm-input" />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-imm-input', 'acc-imm-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul id="acc-imm-list" class="simple-list"></ul>
                            </div>

                            <div class="form-group">
                                <label>إجراءات قصيرة المدى (Short-term):</label>
                                <div class="input-with-button">
                                    <input type="text" id="acc-short-input" />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-short-input', 'acc-short-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul
                                    id="acc-short-list"
                                    class="simple-list"
                                ></ul>
                            </div>

                            <div class="form-group">
                                <label>إجراءات بعيدة المدى (Long-term):</label>
                                <div class="input-with-button">
                                    <input type="text" id="acc-long-input" />
                                    <button
                                        type="button"
                                        class="btn-secondary btn-small"
                                        onclick="addToList('acc-long-input', 'acc-long-list')"
                                    >
                                        إضافة
                                    </button>
                                </div>
                                <ul id="acc-long-list" class="simple-list"></ul>
                            </div>
                        </div>

                        <div class="card">
                            <h3>
                                <i class="fas fa-tasks"></i> خطة العمل (Action
                                Plan)
                            </h3>

                            <div class="results-table-container">
                                <table class="results-table">
                                    <thead>
                                        <tr>
                                            <th style="min-width: 200px">
                                                الإجراء التصحيحي
                                            </th>
                                            <th style="min-width: 150px">
                                                المسؤول
                                            </th>
                                            <th style="min-width: 130px">
                                                تاريخ التنفيذ
                                            </th>
                                            <th style="width: 50px">حذف</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <input
                                                    type="text"
                                                    id="plan-action"
                                                    placeholder="الإجراء..."
                                                />
                                            </td>
                                            <td>
                                                <input
                                                    type="text"
                                                    id="plan-resp"
                                                    placeholder="المسؤول..."
                                                />
                                            </td>
                                            <td>
                                                <input
                                                    type="date"
                                                    id="plan-date"
                                                />
                                            </td>
                                            <td style="text-align: center">
                                                <button
                                                    type="button"
                                                    class="btn btn-secondary btn-small"
                                                    onclick="addActionPlanRow()"
                                                >
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody id="acc-plan-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <button
                            type="submit"
                            class="btn btn-primary"
                            style="width: 100%; margin-top: 20px"
                        >
                            حفظ التقرير
                        </button>
                    </form>
                </section>

                <section
                    id="MonitorAccidents"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-folder-open"></i> الحوادث المفتوحة
                        (Open Accidents)
                    </h2>
                    <div class="app-form">
                        <button
                            class="btn btn-secondary"
                            onclick="loadUserOpenAccidents()"
                            style="margin-bottom: 15px"
                        >
                            <i class="fas fa-sync"></i> تحديث القائمة
                        </button>
                        <div
                            id="open-accidents-list"
                            class="results-table-container"
                        >
                            <p style="text-align: center">جاري التحميل...</p>
                        </div>
                    </div>
                </section>

                <div id="person-modal" class="modal" style="display: none">
                    <div class="modal-content">
                        <span class="close" onclick="closePersonModal()"
                            >&times;</span
                        >
                        <h3 id="person-modal-title">إضافة شخص</h3>

                        <div class="form-group">
                            <label>النوع:</label>
                            <select
                                id="modal-type"
                                onchange="updatePersonInputs('modal')"
                            >
                                <option value="">اختر...</option>
                                <option value="Employee">موظف</option>
                                <option value="Contractor">مقاول</option>
                                <option value="Visitor">زائر/عامة</option>
                            </select>
                        </div>

                        <div
                            id="modal-emp-group"
                            class="vic-input-group"
                            style="display: none"
                        >
                            <label>اسم الموظف:</label>
                            <select id="modal-emp-select">
                                <option>اختر الموظف...</option>
                            </select>
                            <div class="checkbox-group">
                                <input
                                    type="checkbox"
                                    id="modal-emp-all"
                                    onchange="toggleAllEmployees('modal')"
                                />
                                <label for="modal-emp-all">كل الموظفين</label>
                            </div>
                        </div>

                        <div
                            id="modal-cont-group"
                            class="vic-input-group"
                            style="display: none"
                        >
                            <label>اسم المقاول:</label>
                            <select id="modal-cont-select">
                                <option>اختر المقاول...</option>
                            </select>
                            <div
                                style="display: flex; gap: 5px; margin-top: 5px"
                            >
                                <input
                                    type="text"
                                    id="modal-nid"
                                    placeholder="رقم قومي"
                                />
                                <button
                                    type="button"
                                    class="btn-secondary btn-small"
                                    onclick="searchPersonByNID('modal')"
                                >
                                    بحث
                                </button>
                            </div>
                            <input
                                type="text"
                                id="modal-cont-name"
                                placeholder="الاسم"
                                style="margin-top: 5px"
                            />
                        </div>

                        <div
                            id="modal-vis-group"
                            class="vic-input-group"
                            style="display: none"
                        >
                            <label>بيانات الزائر:</label>
                            <input
                                type="text"
                                id="modal-vis-nid"
                                placeholder="رقم قومي"
                            />
                            <input
                                type="text"
                                id="modal-vis-name"
                                placeholder="الاسم"
                                style="margin-top: 5px"
                            />
                        </div>

                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="confirmAddPerson()"
                            style="margin-top: 10px; width: 100%"
                        >
                            إضافة
                        </button>
                    </div>
                </div>
                <section
                    id="MYAccidents"
                    class="page-section"
                    style="display: none"
                >
                    <div
                        class="print-header-only"
                        style="
                            display: none;
                            border-bottom: 2px solid #c8102e;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                            align-items: center;
                            justify-content: space-between;
                        "
                    >
                        <img
                            src="../turnkey.png"
                            alt="Logo"
                            style="max-height: 60px"
                        />
                        <div style="text-align: center; flex-grow: 1">
                            <h1
                                style="
                                    color: #c8102e;
                                    margin: 0;
                                    font-size: 1.8rem;
                                "
                            >
                                سجل الحوادث (Accident Log)
                            </h1>
                            <p
                                style="margin: 5px 0 0 0; font-size: 0.9rem"
                                id="acc-print-date"
                            ></p>
                        </div>
                    </div>

                    <h2 class="no-print">
                        <i class="fas fa-file-medical-alt"></i> سجل الحوادث
                    </h2>

                    <div class="app-form no-print">
                        <div class="filter-controls">
                            <div class="form-group">
                                <label>المشروع:</label>
                                <select id="mon-acc-project">
                                    <option value="ALL_ACCESSIBLE">الكل</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>من:</label>
                                    <input type="date" id="mon-acc-from" />
                                </div>
                                <div class="form-group">
                                    <label>إلى:</label>
                                    <input type="date" id="mon-acc-to" />
                                </div>
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="mon-acc-open" />
                                <label
                                    for="mon-acc-open"
                                    style="font-weight: normal"
                                    >المفتوحة فقط</label
                                >
                            </div>
                            <button type="button" id="mon-acc-btn" class="btn">
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>
                    </div>

                    <div id="mon-acc-results" class="results-table-container">
                        <p
                            style="
                                text-align: center;
                                padding: 20px;
                                color: #666;
                            "
                        >
                            حدد معايير البحث...
                        </p>
                    </div>

                    <button
                        type="button"
                        id="mon-acc-print-btn"
                        class="btn btn-secondary no-print"
                        style="width: 100%; margin-top: 15px; display: none"
                    >
                        <i class="fas fa-print"></i> طباعة المحدد
                    </button>
                </section>
                <section
                    id="TrainingLog"
                    class="page-section"
                    style="display: none"
                >
                    <h2>
                        <i class="fas fa-clipboard-list"></i> سجل التدريب
                        (Training Log)
                    </h2>

                    <div class="app-form">
                        <div class="filter-controls">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="train-start-date"
                                        >من تاريخ:</label
                                    >
                                    <input type="date" id="train-start-date" />
                                </div>
                                <div class="form-group">
                                    <label for="train-end-date"
                                        >إلى تاريخ:</label
                                    >
                                    <input type="date" id="train-end-date" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="train-project-filter"
                                    >المشروع:</label
                                >
                                <select id="train-project-filter">
                                    <option value="all">جميع المشاريع</option>
                                </select>
                            </div>
                            <button
                                type="button"
                                class="btn"
                                onclick="window.fetchTrainingLogs()"
                            >
                                <i class="fas fa-search"></i> بحث
                            </button>
                        </div>

                        <div
                            id="training-results-container"
                            class="results-table-container"
                        >
                            <table class="results-table">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>المشروع</th>
                                        <th>الموضوع (Topic)</th>
                                        <th>المدرب</th>
                                        <th style="text-align: center">
                                            العدد
                                        </th>
                                        <th style="text-align: center">
                                            التفاصيل
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="training-table-body">
                                    <tr>
                                        <td
                                            colspan="6"
                                            style="
                                                text-align: center;
                                                padding: 20px;
                                                color: #666;
                                            "
                                        >
                                            حدد معايير البحث واضغط على زر بحث...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <div
                    id="attendees-modal"
                    class="modal"
                    onclick="if(event.target == this) window.closeAttendeesModal()"
                >
                    <div
                        class="modal-content"
                        style="max-width: 800px; width: 95%"
                    >
                        <span
                            class="close"
                            onclick="window.closeAttendeesModal()"
                            style="
                                cursor: pointer;
                                font-size: 30px;
                                float: left;
                            "
                            >&times;</span
                        >

                        <h3
                            id="modal-session-title"
                            style="
                                color: var(--primary-color);
                                border-bottom: 2px solid #eee;
                                padding-bottom: 10px;
                                margin-bottom: 15px;
                            "
                        >
                            قائمة الحضور
                        </h3>

                        <div
                            class="results-table-container"
                            style="max-height: 70vh; overflow-y: auto"
                        >
                            <table class="results-table">
                                <thead>
                                    <tr>
                                        <th
                                            style="
                                                width: 50px;
                                                text-align: center;
                                            "
                                        >
                                            #
                                        </th>
                                        <th>الاسم</th>
                                        <th>الشركة</th>
                                        <th style="text-align: center">
                                            الصفة
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="attendees-list-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div
                    id="worker-selector-modal"
                    class="modal"
                    onclick="if(event.target == this) window.closeWorkerSelector()"
                >
                    <div class="modal-content worker-selection-modal">
                        <span
                            class="close-modal"
                            onclick="window.closeWorkerSelector()"
                            >&times;</span
                        >

                        <h3
                            style="
                                text-align: center;
                                color: var(--primary-color);
                                margin-bottom: 20px;
                            "
                        >
                            <i class="fas fa-users"></i> اختيار عامل المقاول
                        </h3>

                        <div class="form-group" style="margin-bottom: 15px">
                            <input
                                type="text"
                                id="worker-search-box"
                                placeholder="ابحث بالاسم أو الرقم القومي..."
                                oninput="window.filterWorkerList()"
                                class="search-input-fancy"
                            />
                        </div>

                        <div
                            id="worker-list-container"
                            class="modal-scroll-area"
                        ></div>

                        <div class="worker-modal-footer">
                            <button
                                type="button"
                                class="btn-new-worker-full"
                                onclick="window.addNewWorkerManually()"
                            >
                                <i class="fas fa-user-plus"></i> إضافة عامل جديد
                                (غير مسجل)
                            </button>
                        </div>
                    </div>
                </div>
                <div
                    id="emp-selector-modal"
                    class="modal"
                    onclick="if(event.target == this) window.closeEmpSelector()"
                >
                    <div class="modal-content worker-selection-modal">
                        <span
                            class="close-modal"
                            onclick="window.closeEmpSelector()"
                            >&times;</span
                        >
                        <h3
                            style="
                                text-align: center;
                                color: var(--primary-color);
                            "
                        >
                            <i class="fas fa-user-check"></i> اختيار الموظف
                        </h3>

                        <div class="form-group" style="margin-bottom: 15px">
                            <input
                                type="text"
                                id="emp-search-box"
                                placeholder="ابحث بالاسم أو الكود..."
                                oninput="window.filterEmpList()"
                                class="search-input-fancy"
                            />
                        </div>

                        <div
                            id="emp-list-container"
                            class="modal-scroll-area"
                        ></div>
                    </div>
                </div>
                <div
                    id="ncrvio-emp-modal"
                    class="modal"
                    onclick="if(event.target == this) window.closeNcrVioEmpSelector()"
                >
                    <div class="modal-content worker-selection-modal">
                        <span
                            class="close-modal"
                            onclick="window.closeNcrVioEmpSelector()"
                            >&times;</span
                        >
                        <h3
                            id="ncrvio-modal-title"
                            style="
                                text-align: center;
                                color: var(--primary-color);
                            "
                        >
                            اختر الموظف
                        </h3>
                        <div class="form-group" style="margin-bottom: 15px">
                            <input
                                type="text"
                                id="ncrvio-emp-search-box"
                                placeholder="ابحث بالاسم أو الكود..."
                                oninput="window.filterNcrVioEmpList()"
                                class="search-input-fancy"
                            />
                        </div>
                        <div
                            id="ncrvio-emp-list-container"
                            class="modal-scroll-area"
                        ></div>
                    </div>
                </div>
            </main>
        </div>

        <script src="app.js"></script>
        <script>
            function toggleLanguage() {
                const enDiv = document.getElementById("content-en");
                const arDiv = document.getElementById("content-ar");
                const btn = document.getElementById("lang-switch-btn");
                const btnText = btn.querySelector("span");

                if (enDiv.style.display === "none") {
                    // --- العودة للإنجليزية (يمين) ---
                    arDiv.style.display = "none";
                    enDiv.style.display = "block";

                    btnText.textContent = "العربية";

                    // إزالة كلاس اليسار (ليرجع يمين)
                    btn.classList.remove("ar-pos");

                    // Animation
                    enDiv.classList.remove("fade-in");
                    void enDiv.offsetWidth;
                    enDiv.classList.add("fade-in");
                } else {
                    // --- التحويل للعربية (شمال) ---
                    enDiv.style.display = "none";
                    arDiv.style.display = "block";

                    btnText.textContent = "English";

                    // إضافة كلاس اليسار
                    btn.classList.add("ar-pos");

                    // Animation
                    arDiv.classList.remove("fade-in");
                    void arDiv.offsetWidth;
                    arDiv.classList.add("fade-in");
                }
            }
        </script>
    </body>
</html>
